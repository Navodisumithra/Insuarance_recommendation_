<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<title>Insurance Claim Form</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { background: linear-gradient(135deg, #fff3e0, #ede7f6); font-family: 'Segoe UI', sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 30px;}
.form-container { background: #fff; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); padding: 40px; max-width: 900px; width: 100%; }
h2 { text-align:center; font-weight:700; margin-bottom:25px; background: linear-gradient(to right, #00695c, #6a1b9a); -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
.section-title { margin-top:30px; font-size:1.2rem; font-weight:700; color:#333; border-left:5px solid #6a1b9a; padding-left:10px;}
.btn-submit { background: linear-gradient(135deg, #00796b, #6a1b9a); color:#fff; font-weight:600; border-radius:12px; padding:12px 30px; transition: all 0.3s ease; }
.btn-submit:hover { background: linear-gradient(135deg, #004d40, #4a148c); transform: scale(1.05);}
.alert-container { margin-top:20px;}
</style>
</head>
<body>

<div class="form-container">
<h2><i class="fa-solid fa-file-circle-check"></i> Insurance Claim Form</h2>
<form id="claimForm">
<div class="row g-3">

<div class="col-md-6">
<label><i class="fa-solid fa-id-card"></i> NIC Number</label>
<input type="text" class="form-control" name="NIC" required pattern="^([0-9]{9}[xXvV]|[0-9]{12})$">
</div>

<div class="col-md-6">
<label><i class="fa-solid fa-shield-heart"></i> Insurance Plan</label>
<select class="form-select" name="InsurancePlan" required>
<option value="" disabled selected>Select your registered plan...</option>
<option value="Divithilna Protection Plan">Divithilna Protection Plan</option>
<option value="Early Cash">Early Cash</option>
<option value="Freedom LifeStyle Plus Plan">Freedom LifeStyle Plus Plan</option>
<option value="Janadhiri">Janadhiri</option>
<option value="Speed Investment Plan">Speed Investment Plan</option>
<option value="FREEDOM">FREEDOM</option>
<option value="Minimuthu Parithyaga">Minimuthu Parithyaga</option>
<option value="SLIC Wealth Plus">SLIC Wealth Plus</option>
<option value="SLIC Divisavi Protection Plan">SLIC Divisavi Protection Plan</option>
<option value="Minimuthu Dayada">Minimuthu Dayada</option>
<option value="School Fee Protector">School Fee Protector</option>
<option value="Swarna Dhaja">Swarna Dhaja</option>
</select>
</div>

<div class="col-md-6">
<label>Date of Incident</label>
<input type="date" class="form-control" name="IncidentDate" required>
</div>

<div class="col-md-6">
<label>Claim Amount (LKR)</label>
<input type="number" class="form-control" name="ClaimAmount" min="0" required>
</div>

<div class="col-12">
<label>Description of Incident</label>
<textarea class="form-control" name="Description" rows="3" required></textarea>
</div>

<div class="text-center mt-4">
<button type="submit" class="btn btn-submit"><i class="fa-solid fa-paper-plane"></i> Submit Claim</button>
</div>
</div>

</form>

<div id="msgBox" class="alert-container"></div>

<script>
function validateForm() {
    const form = document.getElementById("claimForm");
    let isValid = true;
    form.querySelectorAll("[required]").forEach(input => {
        if (!input.value.trim()) { input.classList.add("is-invalid"); isValid = false; }
        else { input.classList.remove("is-invalid"); }
    });
    return isValid;
}

document.getElementById("claimForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const form = e.target;
    const msgBox = document.getElementById("msgBox");

    if (!validateForm()) {
        msgBox.innerHTML = `<div class="alert alert-danger">Please fill all required fields correctly.</div>`;
        return;
    }

    const formData = new FormData(form);

    try {
        const res = await fetch("http://127.0.0.1:5000/insurance_claim", {
            method: "POST",
            body: formData
        });
        const data = await res.json();

        if (res.ok) {
            msgBox.innerHTML = `<div class="alert alert-success">${data.message} ${data.reason ? "(" + data.reason + ")" : ""}</div>`;
        } else {
            msgBox.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
        }
    } catch(err) {
        msgBox.innerHTML = `<div class="alert alert-danger">Request failed: ${err.message}</div>`;
    }

});

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
